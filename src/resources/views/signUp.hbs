<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css"
    integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">
  <link rel="stylesheet" href="/css/main.css" />
  <link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/jquery-datetimepicker/2.5.20/jquery.datetimepicker.css">
</head>

<body>
  <div class="wrapper-auth">
    <div class="container main d-flex justify-content-center align-items-center h-100">
      <div class="row">
        <div class="col-md-6 side-image">
        </div>
        <div class="col-md-6 right">
          <div class="input-box">
            <header>Create account</header>
            <form id="form" method="POST">
              <div class="input-field">
                <input type="text" name="email" id="email" class="input" required>
                <label class="form-label" for="email">Email</label>
                <small></small>
              </div>
              <div class="input-field">
                <input type="text" name="username" id="fullname" class="input" required>
                <label class="form-label" for="fullname">Fullname</label>
                <small></small>
              </div>
              <div class="input-field">
                <input type="password" name="password" id="password" class="input" required>
                <label class="form-label" for="password">Password</label>
                <small></small>
              </div>
              <div class="input-field">
                <input type="password" name="rePassword" id="rePassword" class="input" required>
                <label class="form-label" for="rePassword">Confirm password</label>
                <small></small>
              </div>
              <div class="input-field">
                <input type='text' class='input' id="dob" name="dob" required />
                <label class="form-label" for='rePassword'>
                  Day Of Birth
                </label>
              </div>
              <div class="input-field">
                <input type="submit" class="submit" value="Sign Up">
              </div>
            </form>
            <div class="login">
              <span>Already have an account?
                <a href="login">Log in</a>
              </span>
            </div>
            <div class='sign-up-accounts'>
              <p class='text-center'>
                Or Sign Up
              </p>
              <div class='social-accounts d-flex justify-content-center'>
                <a href='#' title='Google'>
                  <i class='fa-brands fa-google'></i>
                </a>
                <a href='#' title='Facebook'>
                  <i class='fa-brands fa-facebook'></i>
                </a>
                <a href='#' title='Twitter'>
                  <i class='fa-brands fa-twitter'></i>
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>


  <script src="https://code.jquery.com/jquery-3.5.1.js" integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc="
    crossorigin="anonymous"></script>
  {{!--
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"
    integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
    crossorigin="anonymous"></script> --}}
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
    integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.min.js"
    integrity="sha384-+sLIOodYLS7CIrQpBjl+C7nPvqq+FbNUBDunl/OZv93DB7Ln/533i8e/mZXLi/P+"
    crossorigin="anonymous"></script>
  <script src="https://kit.fontawesome.com/3a1f297a4d.js" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-datetimepicker/2.5.20/jquery.datetimepicker.full.min.js">
  </script>

  <script src="https://code.jquery.com/jquery-3.5.1.js" integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc="
    crossorigin="anonymous"></script>
  {{!--
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"
    integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
    crossorigin="anonymous"></script> --}}
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
    integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.min.js"
    integrity="sha384-+sLIOodYLS7CIrQpBjl+C7nPvqq+FbNUBDunl/OZv93DB7Ln/533i8e/mZXLi/P+"
    crossorigin="anonymous"></script>
  <script src="https://kit.fontawesome.com/3a1f297a4d.js" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-datetimepicker/2.5.20/jquery.datetimepicker.full.min.js">
  </script>
  <script>
    const form = document.getElementById('form');
    const name = document.getElementById('fullname');
    const email = document.getElementById('email');
    const password = document.getElementById('password');
    const rePassword = document.getElementById('rePassword');
    const dob = document.getElementById('dob');
    console.log("dob: ", dob);
    console.log("dobvalue: ", dob.value);

    function checkInput() {
      let check = true;
      const nameValue = name.value.trim();
      const emailValue = email.value.trim();
      const passwordValue = password.value.trim();
      const rePasswordValue = rePassword.value.trim();
      console.log("name: ", nameValue)
      console.log('email:', emailValue)


      if (!isEmail(emailValue)) {
        setErrorFor(email, 'invalid email');
        check = false;
      } else {
        console.log(emailValue)
        //ajax bat dong bo
        $.ajaxSetup({
          async: false
        });
        $.getJSON(`http://localhost:3000/auth/isExist?email=${emailValue}`, (data) => {
          console.log(data)
          if (data === false) {
            setSuccessFor(email);
          }
          else {
            check = false;
            setErrorFor(email, 'Email already exists')
            console.log(check)
          }
        });
        $.ajaxSetup({
          async: true
        });
      }

      if (!isValidPass(passwordValue)) {
        setErrorFor(password, 'least one numeric digit, one uppercase, lowercase letter')
        check = false;
      } else {
        setSuccessFor(password)
      }

      if (passwordValue != rePasswordValue) {
        setErrorFor(rePassword, 'password does not match')
        check = false;
      } else {
        setSuccessFor(rePassword)
      }
      return check;
    }

    function setErrorFor(input, msg) {
      const formControl = input.parentElement;
      console.log(formControl)
      const small = formControl.querySelector('small');

      small.innerText = msg;

    }
    function setSuccessFor(input) {
      const formControl = input.parentElement;
      const small = formControl.querySelector('small');
      small.innerText = '';
    }

    function isEmail(email) {
      return /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(email);
    }
    function isValidPass(password) {
      const regex = /^(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{6,20}$/;
      return regex.test(password);
    }

    form.addEventListener('submit', e => {
      console.log('submittttttt')
      e.preventDefault();
      if (checkInput()) {
        e.currentTarget.submit();
      }

    });
    $('#name').select();
    $('#dob').datetimepicker({
      timepicker: false,
      format: 'd/m/Y',
      mask: true
    });
  </script>
</body>

</html>